# 📊 投資組合功能使用指南

## 🎯 功能概述

投資組合功能幫助你追蹤股票、ETF 等投資標的的持倉、市值和損益。

---

## 📖 重要概念

### 欄位說明

| 欄位 | 說明 | 範例 |
|------|------|------|
| **標的** | 股票代碼和名稱 | 2330 - 台積電 |
| **類型** | 投資類別 | 台股、美股、加密貨幣 |
| **數量** | 持有股數 | 4 股 |
| **平均成本** | 買入的平均價格（每股） | $250/股 |
| **現值** | 最新市場價格（每股） | $1450/股 |
| **總成本** | 買入總金額 | $1,000 (4股 × $250) |
| **市值** | 當前總價值 | $5,800 (4股 × $1450) |
| **損益** | 賺賠金額和百分比 | +$4,800 (+480%) |

### 關鍵理解

1. **平均成本** = 所有買入交易的加權平均價格（固定不變）
2. **現值** = 股票的最新市場價格（需要手動更新）
3. **市值** = 數量 × 現值（自動計算）
4. **損益** = 市值 - 總成本（自動計算）

---

## 🚀 使用流程

### 1️⃣ 新增交易

1. 點擊「新增交易」按鈕
2. 填寫資訊：
   - **交易類型**：買入/賣出
   - **代碼**：股票代碼（例如：2330、TSLA）
   - **名稱**：股票名稱（例如：台積電）
   - **數量**：買入股數
   - **單價**：買入價格（每股）
   - **手續費**：交易手續費（選填）
   - **付款帳戶**：扣款的銀行帳戶
   - **券商帳戶**：持倉的券商帳戶
   - **交易日期**：交易發生日期
3. 點擊「確認」

**範例：**
```
買入 4 股台積電
- 代碼：2330
- 名稱：台積電
- 數量：4
- 單價：250
- 付款帳戶：台幣活存
- 券商帳戶：台股帳戶
```

系統會自動：
- 創建持倉記錄
- 從付款帳戶扣款：$1,000
- 記錄到資產總覽的流水帳

---

### 2️⃣ 更新價格（重要！）

**為什麼需要更新？**
- 買入時，系統將「現值」設為買入價格
- 股價每天變動，但系統不會自動更新
- 需要手動更新才能看到最新的市值和損益

**如何更新？**

1. **在持倉明細表格中**，找到要更新的股票
2. **點擊該行的 🔄 按鈕**（操作欄）
3. 對話框會顯示當前資訊：
   ```
   2330 - 台積電
   持有數量: 4 股
   平均成本: $250/股
   現值（舊）: $250/股
   ```
4. **查詢最新價格**：
   - 台股：開啟券商 App 或 [台灣證券交易所](https://www.twse.com.tw/)
   - 美股：開啟券商 App 或 [Yahoo Finance](https://finance.yahoo.com/)
   - 加密貨幣：開啟交易所 App（幣安、MAX 等）
5. **輸入最新價格**，例如：`1450`
6. **查看預覽**：
   ```
   現值（新）：$1450/股
   市值：$5,800（4股 × $1450）
   總成本：$1,000
   損益：+$4,800 (+480%) ✅
   ```
7. 確認無誤後，點擊「確認更新」

**更新頻率建議：**
- 📅 每日收盤後更新（最準確）
- 📅 每週更新一次（省時間）
- 📅 想查看損益時更新（隨需）

---

### 3️⃣ 查看總覽

更新價格後，投資組合頁面會顯示：

**總覽卡片：**
- **總市值**：所有持倉的市值總和
- **總成本**：所有持倉的成本總和
- **總損益**：總市值 - 總成本

**資產分佈圖：**
- 圓餅圖顯示不同類型（台股、美股、加密貨幣）的市值佔比

**持倉明細表格：**
- 每個持倉的詳細資訊
- 即時計算損益和漲跌幅

---

## 💡 實際範例

### 範例 1：台積電投資

**Day 1 - 買入**
```
交易：買入 2330 台積電
數量：4 股
單價：$250/股
總金額：$1,000
```

系統記錄：
- 平均成本：$250
- 現值：$250（等於買入價）
- 市值：$1,000
- 損益：$0 (0%)

---

**Day 30 - 價格上漲**

台積電漲到 $1450，但系統顯示：
```
❌ 錯誤顯示（未更新價格）
現值：$250
市值：$1,000
損益：$0 (0%)
```

---

**執行價格更新：**

1. 點擊 🔄 按鈕
2. 查詢 Yahoo Finance：台積電 = $1450
3. 輸入：`1450`
4. 預覽：
   ```
   現值（新）：$1450/股
   市值：$5,800
   總成本：$1,000
   損益：+$4,800 (+480%)
   ```
5. 確認更新 ✅

---

**更新後顯示：**
```
✅ 正確顯示
現值：$1450
市值：$5,800
損益：+$4,800 (+480%) 🎉
```

---

### 範例 2：美股 TSLA

**買入交易**
```
代碼：TSLA
名稱：Tesla
數量：10 股
單價：$250/股
總金額：$2,500
```

**30 天後更新**
```
查詢價格：Yahoo Finance 顯示 TSLA = $350
點擊 🔄 → 輸入 350 → 確認

更新後：
現值：$350/股
市值：$3,500
損益：+$1,000 (+40%)
```

---

## ⚙️ 進階功能

### 賣出持倉

1. 點擊「新增交易」
2. 選擇「賣出」
3. 填寫賣出數量和價格
4. 系統會：
   - 減少持倉數量
   - 收入存入付款帳戶
   - 記錄實現損益

### 刪除持倉

⚠️ 注意：刪除持倉會清除所有記錄，無法復原！

1. 點擊持倉旁的 🗑️ 按鈕
2. 確認刪除

建議：若要清空持倉，使用「賣出」交易而非刪除

---

## 📊 資料庫說明

### 持倉資料儲存位置

- 表格：`investment_holdings`
- 欄位包含：
  - `broker_account_id`：券商帳戶 ID
  - `ticker`：股票代碼
  - `quantity`：數量
  - `averageCost`：平均成本
  - `currentPrice`：現值（需手動更新）

### 交易記錄儲存位置

- 表格：`investment_transactions`
- 記錄所有買入/賣出交易

### 流水帳整合

投資交易會同步到「資產總覽」的流水帳：
- 買入 → 支出記錄
- 賣出 → 收入記錄
- 分類：「股票買入」、「股票賣出」

---

## 🔧 常見問題

### Q1: 為什麼損益一直是 0？
**A:** 因為「現值」沒有更新，還是顯示買入價格。請點擊 🔄 按鈕更新最新價格。

### Q2: 如何自動更新價格？
**A:** 目前需要手動更新。未來版本可能會整合金融 API 實現自動更新。

### Q3: 可以追蹤哪些投資？
**A:** 
- ✅ 台股（2330、0050 等）
- ✅ 美股（TSLA、AAPL、NVDA 等）
- ✅ 加密貨幣（BTC、ETH 等）
- ✅ 任何有價格的投資標的

### Q4: 平均成本如何計算？
**A:** 加權平均。例如：
```
第一次買入：2 股 @ $100 = $200
第二次買入：3 股 @ $150 = $450
總成本：$650
總股數：5 股
平均成本：$650 ÷ 5 = $130/股
```

### Q5: 手續費會計入成本嗎？
**A:** 是的，手續費會加到總成本中，影響平均成本計算。

---

## 🎯 最佳實踐

1. **每筆交易後立即記錄**
   - 趁記憶猶新，資訊最準確
   
2. **定期更新價格**
   - 建議每週或每月固定時間更新
   
3. **保留交易記錄**
   - 不要隨意刪除，保留完整歷史
   
4. **分類清楚**
   - 台股、美股、加密貨幣分開管理
   
5. **多元化投資**
   - 利用資產分佈圖檢視投資組合平衡

---

## 🚀 快速開始清單

- [ ] 1. 執行資料庫遷移（見 `NEON_DATABASE_UPDATE.md`）
- [ ] 2. 創建券商帳戶（類型：台股/美股/加密貨幣）
- [ ] 3. 記錄第一筆投資交易
- [ ] 4. 嘗試更新價格（點擊 🔄）
- [ ] 5. 查看總覽和損益統計

---

## 📞 需要幫助？

如有問題或建議，歡迎提出 Issue 或 Pull Request！

---

**版本：** 1.0.0  
**最後更新：** 2025-10-23
